# 腾讯云开发 云端数据接入（快速上线、少写后端）

用腾讯云开发 CloudBase 做后端，数据存云端，多人共享、换设备也能用。

## 一、注册并创建环境

1. 打开 [腾讯云开发控制台](https://console.cloud.tencent.com/tcb)
2. 登录腾讯云账号，创建环境（选「按量付费」或免费额度）
3. 创建完成后，在环境列表找到 **环境 ID**（形如 `xxx-xxxxx`）

## 二、配置项目

编辑 `js/config.js`，填入你的环境 ID：

```javascript
const TENCENT_ENV_ID = '你的环境ID';
```

## 三、开启匿名登录

1. 控制台 → 选择你的环境 → **登录授权**
2. 找到「匿名登录」，点击 **开启**

## 四、添加安全域名

1. 控制台 → **安全配置** → **Web 安全域名**
2. 添加你的网站域名（如 `localhost`、`127.0.0.1`、部署后的域名）
3. 本地开发需添加 `localhost` 或 `127.0.0.1`

## 五、创建数据库集合

1. 控制台 → **数据库** → **集合**
2. 点击「新建集合」，名称填：`LoveBase`（大小写必须一致）
3. 无需手动建字段，首次写入会自动创建

## 六、配置数据库权限（必做）

**重要**：CloudBase 默认安全规则会拒绝所有访问，必须手动放通。

1. 控制台 → **数据库** → 点击集合 `LoveBase` → **权限设置**
2. 切换到「安全规则」或「自定义安全规则」
3. 填入以下规则，允许已登录用户（含匿名）读写：

```json
{
  "read": "auth != null",
  "write": "auth != null"
}
```

4. 保存规则

## 七、部署

配置完成后，按 `DEPLOY.md` 部署到 Vercel / Netlify 等。部署后记得在安全域名中添加你的线上域名。

## 八、数据没进数据库？排查步骤

1. **打开浏览器控制台（F12）**，看是否有：
   - `腾讯云 初始化失败` → 检查匿名登录、安全域名
   - `腾讯云 保存失败` → 多半是**数据库权限未配置**，按第六步设置安全规则
   - `腾讯云 保存成功` → 说明写入成功，去控制台数据库里刷新查看

2. **确认匿名登录已开启**：控制台 → 登录授权 → 匿名登录

3. **确认安全域名**：控制台 → 安全配置 → Web 安全域名，添加 `localhost`、`127.0.0.1` 或你的访问域名

4. **确认集合名**：必须是 `LoveBase`，不能是 `lovebase` 或其他

5. **确认是文档数据库**：在「数据库」→「集合」下操作，不是「关系型数据库」

---

**注意**：配置完成后需刷新页面。首次加载会从云端拉取数据，可能稍慢。免费额度：数据库 2GB、日 3 万次写入、5 万次读取。
